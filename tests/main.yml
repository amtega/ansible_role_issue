---
# Tasks for tesing role

- name: run idempotence test
  hosts: localhost
  roles:
    - role: amtega.docker_presets
    - role: amtega.docker_sandbox
      docker_sandbox_state: started

- name: test role amtega.issue
  hosts: docker_sandbox_containers
  roles:
    - amtega.issue
  vars:
    issue_message: This is the issue
    issue_net_message: Here is the issue on the net
  tasks:
    - name: read /etc/issue file
      shell: cat /etc/issue
      register: read_issue_file_result

    - name: read /etc/issue.net file
      shell: cat /etc/issue.net
      register: read_issue_net_file_result

    - name: test /etc/issue
      assert:
        that:
          - read_issue_file_result.stdout == issue_message

    - name: test /etc/issue
      assert:
        that:
          - read_issue_net_file_result.stdout == issue_net_message
  tags:
    - idempotence

- name: cleanup docker docker sandbox
  hosts: localhost
  roles:
    - role: amtega.docker_sandbox
      docker_sandbox_state: absent
